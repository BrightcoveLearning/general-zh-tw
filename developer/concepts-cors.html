---
title: '了解 CORS'
description: '在本主題中，您將了解關於跨域引用資產（例如視頻、圖像和腳本）的 Web 中內置的 CORS 和約束。'
parent: Developers
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Overview">概述</h2>
    <p>跨域資源共享（CORS）是一種機制，它允許網頁向除提供該網頁的域之外的其他域發出請求。通常，Web瀏覽器會禁止跨域請求。CORS定義了域可以交互以確定是否允許跨域請求的方式。</p>
    <aside class="bcls-aside bcls-aside--information">請注意，CORS 是<strong>不是</strong>由crossdomain.xml 啟用或與之相關，crossdomain.xml 是一種為Flash 應用程序啟用跨域請求的機制。</aside>
  </section>
  <section class="bcls-section">
    <h2 id="corsandbc">CORS和Brightcove</h2>
    <p>在三種情況下，必須將CORS與Brightcove服務/產品一起使用：</p>
    <ol>
      <li><strong>視頻字幕</strong>：包含視頻字幕的文件可以存儲在非Brightcove域中。由於視頻本身將由Brightcove域提供，因此將導致跨域問題。</li>
      <li><strong>Brightcove播放器和HLS</strong>：這<span class="video-cloud-only" translate="No">布萊克夫球員</span> HLS 插件使用 AJAX 請求來檢索 HLS 視頻的清單和各個片段。由於這些HLS資源可以存儲在任何Internet可訪問的域中，因此這些資源可能是由與服務播放器的Brightcove域不同的服務器（通常是CDN域）提供的。這將再次導致跨域問題。</li>
      <li><strong>視頻靜止圖像和縮略圖圖像</strong>： 為了<a href="https://studio.support.brightcove.com/media/capturing-poster-and-thumbnail-images.html">在Studio中捕獲視頻靜止圖像和縮略圖圖像</a>，視頻演示必須帶有CORS標頭（默認情況下，應在Brightcove的大多數內部CDN上啟用該標頭）；如果您有一個自定義CDN，或者我們尚未更新，則無法進行圖像捕獲</li>
    </ol>
  </section>
  <section class="bcls-section">
    <h2 id="solution">解決方案</h2>
    <p>Brightcove目前使用的解決方案涉及配置<code translate="No">Access-Control-Allow-Origin</code> CDN原始服務器的配置文件中的標頭。重要的是要注意，由於不同的CDN合作夥伴使用不同的服務器解決方案來傳遞其內容，因此下面的標頭信息僅作為示例提供，而不是作為插入式代碼段提供。</p>
    <p>Brightcove已成功使用以下內部CDN服務器屬性的標頭指令：</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;FilesMatch ".(vtt|xml)$"&gt;
              Header set Access-Control-Allow-Headers: X-Requested-With
              Header add Access-Control-Allow-Origin: http://admin.brightcove.com
          &lt;/FilesMatch&gt;</code></pre>
    <p>以下內容對該指令進行了簡要說明：</p>
    <ul>
      <li><code translate="No">&lt;FilesMatch ".(vtt|xml)$"&gt;</code>：此條件設置<code translate="No">Access-Control-Allow-Origin</code>僅在vtt或xml文件上的標頭。測試已確認此標頭未與圖像或其他HTTP傳遞的內容一起發送。</li>
      <li><code translate="No">Header set Access-Control-Allow-Headers: X-Requested-With</code>：該標頭是<code translate="No">Access-Control-Allow-Origin</code>標頭起作用，因為播放器發出的請求是XmlHttpRequest。</li>
      <li><code translate="No">Header add Access-Control-Allow-Origin: http://admin.brightcove.com</code>：這是訪問控制標頭本身，用於允許來自指定域的內容。</li>
    </ul>
    <h3>在Apache上啟用CORS</h3>
    <p>您可以在Apache服務器的配置中設置標頭以啟用CORS。將以下內容放在適當的位置<code translate="No">.conf</code>文件：</p>
    <pre class="line-numbers">
<code class="language-bash" translate="No">Header set Access-Control-Allow-Origin "*"</code></pre>
    <p>在上面的示例中，星號充當通配符，並允許訪問所有域。通配符也可以替換為<strong>一</strong>特定領域。通常對於Brightcove播放器而言，這是行不通的，因為在許多情況下，資產將駐留在多個域中。您可以實施其他解決方案，以限制對可接受域的特定白名單的訪問。</p>
    <h3>由 CDN</h3>
    <p>如果您是擁有BYO CDN且存在跨域問題的客戶，則應聯繫您的CDN以獲取有關為帳戶配置CORS的幫助。以下是我們建議的設置：</p>
    <ul>
      <li>訪問控制允許標題：X請求的</li>
      <li>訪問控制允許來源：*</li>
      <li>文件格式：m3u8 m3u ts xml dfxp vtt mpd m4f mp4 jpg png</li>
    </ul>
    <h3>令牌授權要求</h3>
    <p>在需要令牌授權的情況下，需要對上述解決方案進行更改。對於令牌授權，CORS安全模型明確禁止使用<code translate="No">*</code>字符作為值<code translate="No">Access-Control-Allow-Origin</code>響應頭。除此之外<code translate="No">Access-Control-Allow-Credentials</code>響應標頭是必需的，並且必須設置為true。</p>
    <p>用於令牌授權的更新的標頭指令為：</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;FilesMatch ".(m3u8 | m3u | ts)$"&gt;
        # with AJAX withCredentials=true (cookies sent, SSL allowed...)
        SetEnvIfNoCase ORIGIN (.*) ORIGIN=$1
        Header set Access-Control-Allow-Origin "%{ORIGIN}e"
        Header set Access-Control-Allow-Credentials "true"
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L,E=HTTP_ORIGIN:%{HTTP:ORIGIN}]
  &lt;/FilesMatch&gt;</code></pre>
    <p>以下幾點詳細介紹了與早期解決方案的區別：</p>
    <ul>
      <li>該指令查詢傳入請求中是否存在Origin標頭，如果該標頭存在（通常存在），則將其值設置為一個名為<code translate="No">ORIGIN</code>：<code translate="No">SetEnvIfNoCase ORIGIN (.*) ORIGIN=$1</code></li>
      <li>這<code translate="No">Access-Control-Allow-Origin</code>響應頭值設置為<code translate="No">ORIGIN</code>剛剛創建的變量：<code translate="No">Header set Access-Control-Allow-Origin "%{ORIGIN}e"</code><aside class="bcls-aside bcls-aside--information">這<code translate="No">e</code>是必需的，表示這是一個環境變量。</aside>
      </li>
      <li>這<code translate="No">Access-Control-Allow-Credentials</code>標頭必須設置為<code translate="No">true</code>：<code translate="No">Header set Access-Control-Allow-Credentials "true"</code></li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="hls">HLS和CORS</h2>
    <p>在某些環境（例如Amazon S3）中，您可以為HLS指定CORS配置。以下將CORS配置為允許HLS播放。</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;CORSConfiguration&gt;
      &lt;CORSRule&gt;
      &lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt;
      &lt;AllowedMethod&gt;GET&lt;/AllowedMethod&gt;
      &lt;/CORSRule&gt;
&lt;/CORSConfiguration&gt;</code></pre>
    <p>有關特定於Amazon S3的更多信息，請參閱<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/cors.html#how-do-i-enable-cors">啟用跨域資源共享</a>。</p>
    <p>儘管與CORS相切，但客戶端瀏覽器需要接受所有會話cookie才能進行令牌授權的HLS內容交付。雖然某些客戶端瀏覽器（例如Google Chrome和Mozilla Firefox）默認情況下接受會話cookie，但是其他瀏覽器（例如Internet Explorer）則不接受，因此用戶必須啟用此選項。</p>
  </section>
</article>